# ADR-005: Задание 5. Проектирование и реализация выбранных решений для мониторинга, оповещения и логирования
## Автор: Сурков Александр
## Дата: 23.09.2025

## 1. Контекст
В задании 4 [ADR-004-Задание 4. Реализация ETL с использованием Spring Batch.md](../../task-4/results/ADR-004-%D0%97%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%204.%20%D0%A0%D0%B5%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F%20ETL%20%D1%81%20%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%D0%BC%20Spring%20Batch.md) была разработана архитектура системы TradeWare.

## 2. Требования
На основе решения из 'Задание 4' необходимо реализовать системы мониторинга, логирования и оповещения для Spring Batch-приложения.

## 3. Решение
В 'Задание 4' было решено использовать Spring Batch для обработки отчетов. Особенностью этого решения является то, что задания на обработку отчета сервис 'Обработка отчета' получает из Kafka.

Это означает, что сервис будет работать всегда. Но в качестве примера для реализации мониторинга, логирования и оповещения в текущем задании используется решение, которое завершает свою работу после обработки одного отчета.
Поэтому дальнейшее решение будет крутиться вокруг этого решения - быстро живущего приложения(БЖП). 

## 3.1 Метрики - Prometheus
Из-за своей особенности БЖП завершают свою работу раньше, чем Prometheus заберет метрики от приложения. Т.е. Prometheus работает по принципу pull забирая метрики с определенного URL, 
но, т.к. приложение завершает работу непредсказуемо, то URL становится недоступным. 

Чтобы решить эту проблему используется:
- промежуточный сервис pushgateway, в которой отправляются метрики, а он в свою очередь выставляет URL, чтобы Prometheus забрал эти метрики
- приложение должно само отправлять(push) метрики в сервис pushgateway

## 3.2 Оповещение - alertmanager
Отдельным сервисом, но в связи с Prometheus настраивается alertmanager. Он позволяет создавать правила для алертов и отправлять сообщениями различными способами: email, telegram и т.д.

## 3.3 Логи - ELK
Система логирования базируется на следующих продуктах:
- Elastic - база данных. Используется для сбора логов
- Logstash - агрегирует, обогащает и отправляет данные в Elastic.
- FileBeat - собирает логи от приложений и пересылает их в Logstash. Можно сразу пересылать в Elastic, но это не принято. В проекте он подключается через volume. В kubernetes его можно подключить как DaemonSet(тоже используется volume).
- Kibana - UI для работы с логами

[Filebeat vs. Logstash: The Evolution of a Log Shipper](https://logz.io/blog/filebeat-vs-logstash/)

## 4. Альтернативы
- [Fluentd vs. Fluent Bit: Side by Side Comparison](https://logz.io/blog/fluentd-vs-fluent-bit/)

## 5. Недостатки, ограничения, риски
