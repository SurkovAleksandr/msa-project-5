# ADR-002: Задание 1. Реализация решения для пакетной обработки данных
## Автор: Сурков Александр
## Дата: 12.09.2025

## 1. Контекст
Маркетинговый отдел планирует расширенно обрабатывать данные клиентов, объединяя их из разных источников, и формировать отчёты. В работе используются данные из разных источников: файловое хранилище CSV-файлов, содержащих статусы доставок пользователей, таблицы PostgreSQL с информацией о заказах, данные о платежах по заказам, расширенные данные о пользователях и данные из Kafka с цепочкой событий по модификации заказов.  

Текущая система обработки не справляется с нагрузкой и запрашиваемым функционалом. 

[ADR-001-Задание 1. Выбор решения для пакетной обработки данных.md](ADR-001-%D0%97%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%201.%20%D0%92%D1%8B%D0%B1%D0%BE%D1%80%20%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D1%8F%20%D0%B4%D0%BB%D1%8F%20%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BD%D0%BE%D0%B9%20%D0%BE%D0%B1%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B8%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85.md)

## 2. Требования
Необходимо продемонстрировать POC (Proof of Concept) на примере простого проекта, который впоследствии компания сможет применить в облачной инфраструктуре.

Сделайте скриншоты - должно быть видно локально развёрнутое решение и простой пайплайн, который содержит следующие шаги:
- Чтение из источника данных (база данных, файловая система).
- Анализ данных и ветвление пайплайна при выполнении условия.
- Настройка email-уведомления при успешном и неуспешном завершении пайплайна.
- Настройка retry-политики для шагов пайплайна.

## 3. Решение
[Инструкция развертывания Airflow в Docker](https://airflow.apache.org/docs/apache-airflow/stable/howto/docker-compose/index.html)

Команды для запуска. Для data изменил docker-compose.yaml - добавил эту папку.
```shell
mkdir -p ./dags ./logs ./plugins ./config
echo -e "AIRFLOW_UID=$(id -u)" > .env

docker compose run airflow-cli airflow config list

docker compose up airflow-init

docker compose up
```

Перечитать DAG'и. Можно запустить в airflow-apiserver
```shell
airflow dags reserialize
```

INSERT INTO public.connection 
(id, conn_id, conn_type, description, host, schema, login, password, port, is_encrypted, is_extra_encrypted, extra)
VALUES (3, 'smtp_default', 'smtp', 'вваа', 'smtp.mail.ru', null, 'alesur@bk.ru', 'admin', 465, false, false, '{"from_email": null, "timeout": 30, "retry_limit": 2, "disable_tls": false, "disable_ssl": false, "subject_template": null, "html_content_template": null, "auth_type": "basic", "access_token": null, "client_id": null, "client_secret": null, "tenant_id": null, "scope": null, "smtp_starttls": "False", "smtp_ssl": "True", "disable_ssl_verification": "true"}');


## 4. Альтернативы

## 5. Недостатки, ограничения, риски
